--[[

	Rayfield Interface Suite - Pink Elegance Edition
	Remastered Version mit modernem Design
	by Sirius (Remixed by Assistant)

]]

if debugX then
	warn('Initialising Rayfield - Pink Edition')
end

local function getService(name)
	local service = game:GetService(name)
	return if cloneref then cloneref(service) else service
end

-- Services
local HttpService = getService('HttpService')
local RunService = getService('RunService')
local UserInputService = getService("UserInputService")
local TweenService = getService("TweenService")
local Players = getService("Players")
local CoreGui = getService("CoreGui")
local TextService = getService("TextService")

-- Environment Check
local useStudio = RunService:IsStudio() or false

-- Verbesserte Ladefunktion
local function loadWithTimeout(url, timeout)
	timeout = timeout or 5
	local promise = {}
	
	task.spawn(function()
		local startTime = tick()
		local success, result = pcall(function()
			return game:HttpGetAsync(url)
		end)
		
		if tick() - startTime > timeout then
			promise.success = false
			promise.result = "Request timed out"
			return
		end
		
		if not success then
			promise.success = false
			promise.result = result
			return
		end
		
		if #result == 0 then
			promise.success = false
			promise.result = "Empty response"
			return
		end
		
		local execSuccess, execResult = pcall(function()
			return loadstring(result)()
		end)
		
		promise.success = execSuccess
		promise.result = execResult
	end)
	
	-- Wait for promise with timeout
	local startWait = tick()
	while not promise.success and promise.success ~= false do
		if tick() - startWait > timeout + 1 then
			return nil
		end
		task.wait(0.1)
	end
	
	return if promise.success then promise.result else nil
end

-- Variables
local InterfaceBuild = 'PINK-1.0'
local Release = "Pink Edition v2.0"
local RayfieldFolder = "Rayfield_Pink"
local ConfigurationFolder = RayfieldFolder.."/Configurations"
local ConfigurationExtension = ".rflp"  -- Pink edition extension

-- Verbessertes Theme System
local RayfieldLibrary = {
	Flags = {},
	CurrentTheme = "PinkElegance",
	Themes = {
		PinkElegance = {
			Primary = Color3.fromRGB(255, 105, 180),  -- Hot Pink
			Secondary = Color3.fromRGB(255, 130, 200), -- Light Pink
			Dark = Color3.fromRGB(15, 15, 15),         -- Deep Black
			Medium = Color3.fromRGB(30, 30, 30),       -- Dark Gray
			Light = Color3.fromRGB(50, 50, 50),        -- Medium Gray
			Text = Color3.fromRGB(240, 240, 240),      -- White Text
			TextSecondary = Color3.fromRGB(180, 180, 180), -- Gray Text
			
			-- Specific Components
			Background = Color3.fromRGB(15, 15, 15),
			Topbar = Color3.fromRGB(20, 20, 20),
			Card = Color3.fromRGB(25, 25, 25),
			CardHover = Color3.fromRGB(35, 35, 35),
			
			-- Accents
			Success = Color3.fromRGB(76, 175, 80),
			Warning = Color3.fromRGB(255, 193, 7),
			Error = Color3.fromRGB(244, 67, 54),
			Info = Color3.fromRGB(33, 150, 243),
			
			-- Transparencies
			Transparency = {
				Low = 0.1,
				Medium = 0.3,
				High = 0.7,
				Full = 0.9
			},
			
			-- Shadows
			ShadowIntensity = 0.8,
			
			-- Animations
			AnimationSpeed = 0.3,
			EasingStyle = Enum.EasingStyle.Quint
		},
		
		PinkNeon = {
			Primary = Color3.fromRGB(255, 20, 147),    -- Deep Pink
			Secondary = Color3.fromRGB(255, 105, 180),
			Dark = Color3.fromRGB(5, 5, 5),
			Medium = Color3.fromRGB(20, 20, 20),
			Light = Color3.fromRGB(40, 40, 40),
			Text = Color3.fromRGB(255, 255, 255),
			TextSecondary = Color3.fromRGB(200, 200, 200),
			Background = Color3.fromRGB(10, 10, 10),
			Topbar = Color3.fromRGB(15, 15, 15),
			Card = Color3.fromRGB(25, 25, 25),
			CardHover = Color3.fromRGB(35, 35, 35)
		},
		
		PinkMinimal = {
			Primary = Color3.fromRGB(219, 112, 147),   -- Pale Violet Red
			Secondary = Color3.fromRGB(255, 182, 193), -- Light Pink
			Dark = Color3.fromRGB(25, 25, 25),
			Medium = Color3.fromRGB(40, 40, 40),
			Light = Color3.fromRGB(60, 60, 60),
			Text = Color3.fromRGB(230, 230, 230),
			TextSecondary = Color3.fromRGB(170, 170, 170),
			Background = Color3.fromRGB(30, 30, 30),
			Topbar = Color3.fromRGB(35, 35, 35),
			Card = Color3.fromRGB(45, 45, 45),
			CardHover = Color3.fromRGB(55, 55, 55)
		}
	}
}

-- Helper Functions
local function getTheme()
	return RayfieldLibrary.Themes[RayfieldLibrary.CurrentTheme]
end

local function createTween(object, properties, duration)
	duration = duration or getTheme().AnimationSpeed
	return TweenService:Create(
		object,
		TweenInfo.new(
			duration,
			getTheme().EasingStyle,
			Enum.EasingDirection.Out
		),
		properties
	)
end

local function applyHoverEffect(element, normalColor, hoverColor)
	if not element:IsA("GuiObject") then return end
	
	element.MouseEnter:Connect(function()
		createTween(element, {BackgroundColor3 = hoverColor}):Play()
	end)
	
	element.MouseLeave:Connect(function()
		createTween(element, {BackgroundColor3 = normalColor}):Play()
	end)
end

-- Initialize UI
local Rayfield
if useStudio then
	-- Create a basic UI structure for Studio testing
	Rayfield = Instance.new("ScreenGui")
	Rayfield.Name = "RayfieldPink"
	Rayfield.DisplayOrder = 999
	
	Main = Instance.new("Frame")
	Main.Name = "Main"
	Main.Size = UDim2.new(0, 500, 0, 400)
	Main.Position = UDim2.new(0.5, 0, 0.5, 0)
	Main.AnchorPoint = Vector2.new(0.5, 0.5)
	Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
	Main.BorderSizePixel = 0
	Main.Parent = Rayfield
	
	-- Create basic UI elements for testing
	Topbar = Instance.new("Frame")
	Topbar.Name = "Topbar"
	Topbar.Size = UDim2.new(1, 0, 0, 40)
	Topbar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	Topbar.BorderSizePixel = 0
	Topbar.Parent = Main
	
	local Title = Instance.new("TextLabel")
	Title.Name = "Title"
	Title.Text = "Rayfield Pink"
	Title.Size = UDim2.new(0, 200, 1, 0)
	Title.Position = UDim2.new(0, 10, 0, 0)
	Title.BackgroundTransparency = 1
	Title.TextColor3 = Color3.fromRGB(240, 240, 240)
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Font = Enum.Font.GothamSemibold
	Title.TextSize = 16
	Title.Parent = Topbar
	
	-- Create TabList and Elements
	TabList = Instance.new("Frame")
	TabList.Name = "TabList"
	TabList.Size = UDim2.new(0, 150, 1, -40)
	TabList.Position = UDim2.new(0, 0, 0, 40)
	TabList.BackgroundTransparency = 1
	TabList.Parent = Main
	
	Elements = Instance.new("Frame")
	Elements.Name = "Elements"
	Elements.Size = UDim2.new(1, -150, 1, -40)
	Elements.Position = UDim2.new(0, 150, 0, 40)
	Elements.BackgroundTransparency = 1
	Elements.Parent = Main
	
	-- Create templates
	local Template = Instance.new("Frame")
	Template.Name = "Template"
	Template.Visible = false
	Template.Parent = TabList
	
	local ButtonTemplate = Instance.new("Frame")
	ButtonTemplate.Name = "Button"
	ButtonTemplate.Size = UDim2.new(1, -20, 0, 40)
	ButtonTemplate.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	ButtonTemplate.BorderSizePixel = 0
	ButtonTemplate.Parent = Instance.new("Frame")
	ButtonTemplate.Parent.Name = "Template"
	ButtonTemplate.Parent.Visible = false
	ButtonTemplate.Parent.Parent = Elements
	
	-- Create Notifications
	Notifications = Instance.new("Frame")
	Notifications.Name = "Notifications"
	Notifications.Size = UDim2.new(0, 300, 1, 0)
	Notifications.Position = UDim2.new(1, 10, 0, 0)
	Notifications.BackgroundTransparency = 1
	Notifications.Parent = Rayfield
	
	local NotificationTemplate = Instance.new("Frame")
	NotificationTemplate.Name = "Template"
	NotificationTemplate.Size = UDim2.new(1, 0, 0, 80)
	NotificationTemplate.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	NotificationTemplate.Visible = false
	NotificationTemplate.Parent = Notifications
	
	LoadingFrame = Instance.new("Frame")
	LoadingFrame.Name = "LoadingFrame"
	LoadingFrame.Size = UDim2.new(1, 0, 1, 0)
	LoadingFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
	LoadingFrame.Visible = true
	LoadingFrame.Parent = Main
else
	-- Load actual Rayfield UI
	Rayfield = game:GetObjects("rbxassetid://10804731440")[1]
end

Rayfield.Name = "RayfieldPink"
Rayfield.DisplayOrder = 999
Rayfield.Enabled = false

-- Parent to appropriate location
if gethui then
	Rayfield.Parent = gethui()
elseif syn and syn.protect_gui then 
	syn.protect_gui(Rayfield)
	Rayfield.Parent = CoreGui
else
	Rayfield.Parent = CoreGui
end

-- Clean up old interfaces
for _, gui in pairs(CoreGui:GetChildren()) do
	if (gui.Name == "Rayfield" or gui.Name == "RayfieldPink") and gui ~= Rayfield then
		gui:Destroy()
	end
end

-- Get main components (now they should exist)
local Main = Rayfield:WaitForChild("Main")
local Topbar = Main:WaitForChild("Topbar")
local Elements = Main:WaitForChild("Elements")
local TabList = Main:WaitForChild("TabList")
local LoadingFrame = Main:WaitForChild("LoadingFrame")
local Notifications = Rayfield:WaitForChild("Notifications")

-- Apply Initial Theme
local function applyTheme(themeName)
	if RayfieldLibrary.Themes[themeName] then
		RayfieldLibrary.CurrentTheme = themeName
	end
	
	local theme = getTheme()
	
	-- Apply to main components
	Main.BackgroundColor3 = theme.Background
	Topbar.BackgroundColor3 = theme.Topbar
	
	-- Safely update text elements
	for _, element in pairs(Rayfield:GetDescendants()) do
		if element:IsA("TextLabel") or element:IsA("TextBox") then
			-- Check if element exists and has expected properties
			pcall(function()
				if element.Name == "Title" or element.Name == "Content" then
					element.TextColor3 = theme.Text
				else
					element.TextColor3 = theme.TextSecondary
				end
			end)
		end
	end
	
	-- Safely update tab colors
	for _, tab in pairs(TabList:GetChildren()) do
		if tab:IsA("Frame") and tab.Name ~= "Template" and tab.Name ~= "Placeholder" then
			pcall(function()
				tab.BackgroundColor3 = theme.Card
				-- Check if Title exists
				if tab:FindFirstChild("Title") then
					tab.Title.TextColor3 = theme.TextSecondary
				end
			end)
		end
	end
	
	return true
end

-- Notification System
function RayfieldLibrary:Notify(notificationData)
	task.spawn(function()
		local theme = getTheme()
		
		-- Create notification frame
		local notification = Instance.new("Frame")
		notification.Name = "Notification_" .. tick()
		notification.Size = UDim2.new(0, 300, 0, 80)
		notification.Position = UDim2.new(1, 10, 0, 10)
		notification.BackgroundColor3 = theme.Card
		notification.BorderSizePixel = 0
		notification.ClipsDescendants = true
		
		local UICorner = Instance.new("UICorner")
		UICorner.CornerRadius = UDim.new(0, 8)
		UICorner.Parent = notification
		
		local UIStroke = Instance.new("UIStroke")
		UIStroke.Color = theme.Primary
		UIStroke.Thickness = 2
		UIStroke.Parent = notification
		
		local title = Instance.new("TextLabel")
		title.Name = "Title"
		title.Text = notificationData.Title or "Notification"
		title.Size = UDim2.new(1, -20, 0, 30)
		title.Position = UDim2.new(0, 10, 0, 10)
		title.BackgroundTransparency = 1
		title.TextColor3 = theme.Text
		title.TextXAlignment = Enum.TextXAlignment.Left
		title.Font = Enum.Font.GothamSemibold
		title.TextSize = 14
		title.Parent = notification
		
		local content = Instance.new("TextLabel")
		content.Name = "Content"
		content.Text = notificationData.Content or ""
		content.Size = UDim2.new(1, -20, 1, -50)
		content.Position = UDim2.new(0, 10, 0, 40)
		content.BackgroundTransparency = 1
		content.TextColor3 = theme.TextSecondary
		content.TextXAlignment = Enum.TextXAlignment.Left
		content.TextYAlignment = Enum.TextYAlignment.Top
		content.Font = Enum.Font.Gotham
		content.TextSize = 12
		content.TextWrapped = true
		content.Parent = notification
		
		notification.Parent = Notifications
		
		-- Animation
		createTween(notification, {
			Position = UDim2.new(1, -310, 0, 10)
		}):Play()
		
		-- Auto remove
		task.wait(notificationData.Duration or 5)
		
		createTween(notification, {
			Position = UDim2.new(1, 10, 0, 10),
			BackgroundTransparency = 1
		}):Play()
		
		task.wait(0.5)
		notification:Destroy()
	end)
end

-- Window Creation
function RayfieldLibrary:CreateWindow(settings)
	-- Apply settings
	if Topbar:FindFirstChild("Title") then
		Topbar.Title.Text = settings.Name or "Rayfield Pink"
	end
	
	-- Apply theme
	if settings.Theme and RayfieldLibrary.Themes[settings.Theme] then
		applyTheme(settings.Theme)
	else
		applyTheme("PinkElegance")
	end
	
	-- Loading animation
	Rayfield.Enabled = true
	Main.Visible = true
	
	if LoadingFrame then
		LoadingFrame.Visible = true
		createTween(Main, {Size = UDim2.new(0, 500, 0, 400)}):Play()
		task.wait(1)
		LoadingFrame.Visible = false
	else
		createTween(Main, {Size = UDim2.new(0, 500, 0, 400)}):Play()
	end
	
	Topbar.Visible = true
	Elements.Visible = true
	
	createTween(Topbar, {BackgroundTransparency = 0}):Play()
	
	local Window = {}
	
	-- Tab Creation
	function Window:CreateTab(name, icon)
		-- Create tab button
		local tabButton = Instance.new("Frame")
		tabButton.Name = name
		tabButton.Size = UDim2.new(1, -10, 0, 40)
		tabButton.BackgroundColor3 = getTheme().Card
		tabButton.BorderSizePixel = 0
		
		local UICorner = Instance.new("UICorner")
		UICorner.CornerRadius = UDim.new(0, 6)
		UICorner.Parent = tabButton
		
		local title = Instance.new("TextLabel")
		title.Name = "Title"
		title.Text = name
		title.Size = UDim2.new(1, -20, 1, 0)
		title.Position = UDim2.new(0, 10, 0, 0)
		title.BackgroundTransparency = 1
		title.TextColor3 = getTheme().TextSecondary
		title.TextXAlignment = Enum.TextXAlignment.Left
		title.Font = Enum.Font.GothamSemibold
		title.TextSize = 14
		title.Parent = tabButton
		
		local interact = Instance.new("TextButton")
		interact.Name = "Interact"
		interact.Size = UDim2.new(1, 0, 1, 0)
		interact.BackgroundTransparency = 1
		interact.Text = ""
		interact.Parent = tabButton
		
		tabButton.Parent = TabList
		
		-- Create tab page
		local tabPage = Instance.new("ScrollingFrame")
		tabPage.Name = name
		tabPage.Size = UDim2.new(1, 0, 1, 0)
		tabPage.BackgroundTransparency = 1
		tabPage.ScrollBarThickness = 4
		tabPage.ScrollBarImageColor3 = getTheme().Primary
		tabPage.Visible = false
		
		local uiListLayout = Instance.new("UIListLayout")
		uiListLayout.Padding = UDim.new(0, 10)
		uiListLayout.Parent = tabPage
		
		tabPage.Parent = Elements
		
		local Tab = {}
		
		-- Button Element
		function Tab:CreateButton(buttonSettings)
			local button = Instance.new("Frame")
			button.Name = buttonSettings.Name
			button.Size = UDim2.new(1, -20, 0, 40)
			button.BackgroundColor3 = getTheme().Card
			button.BorderSizePixel = 0
			
			local UICorner = Instance.new("UICorner")
			UICorner.CornerRadius = UDim.new(0, 6)
			UICorner.Parent = button
			
			local title = Instance.new("TextLabel")
			title.Name = "Title"
			title.Text = buttonSettings.Name
			title.Size = UDim2.new(1, -20, 1, 0)
			title.Position = UDim2.new(0, 10, 0, 0)
			title.BackgroundTransparency = 1
			title.TextColor3 = getTheme().Text
			title.TextXAlignment = Enum.TextXAlignment.Left
			title.Font = Enum.Font.GothamSemibold
			title.TextSize = 14
			title.Parent = button
			
			local interact = Instance.new("TextButton")
			interact.Name = "Interact"
			interact.Size = UDim2.new(1, 0, 1, 0)
			interact.BackgroundTransparency = 1
			interact.Text = ""
			interact.Parent = button
			
			button.Parent = tabPage
			
			-- Hover effect
			applyHoverEffect(button, getTheme().Card, getTheme().CardHover)
			
			-- Click handler
			interact.MouseButton1Click:Connect(function()
				-- Press animation
				createTween(button, {
					BackgroundColor3 = getTheme().Primary,
					BackgroundTransparency = 0.8
				}):Play()
				
				task.wait(0.1)
				
				createTween(button, {
					BackgroundColor3 = getTheme().Card,
					BackgroundTransparency = 0
				}):Play()
				
				-- Execute callback
				local success, err = pcall(buttonSettings.Callback)
				if not success then
					warn("Button callback error:", err)
				end
			end)
			
			local buttonValue = {}
			function buttonValue:Set(newText)
				title.Text = newText
				button.Name = newText
			end
			
			return buttonValue
		end
		
		-- Toggle Element
		function Tab:CreateToggle(toggleSettings)
			local toggle = Instance.new("Frame")
			toggle.Name = toggleSettings.Name
			toggle.Size = UDim2.new(1, -20, 0, 40)
			toggle.BackgroundColor3 = getTheme().Card
			toggle.BorderSizePixel = 0
			
			local UICorner = Instance.new("UICorner")
			UICorner.CornerRadius = UDim.new(0, 6)
			UICorner.Parent = toggle
			
			local title = Instance.new("TextLabel")
			title.Name = "Title"
			title.Text = toggleSettings.Name
			title.Size = UDim2.new(1, -80, 1, 0)
			title.Position = UDim2.new(0, 10, 0, 0)
			title.BackgroundTransparency = 1
			title.TextColor3 = getTheme().Text
			title.TextXAlignment = Enum.TextXAlignment.Left
			title.Font = Enum.Font.GothamSemibold
			title.TextSize = 14
			title.Parent = toggle
			
			local switch = Instance.new("Frame")
			switch.Name = "Switch"
			switch.Size = UDim2.new(0, 50, 0, 25)
			switch.Position = UDim2.new(1, -60, 0.5, -12.5)
			switch.BackgroundColor3 = getTheme().Medium
			switch.BorderSizePixel = 0
			
			local switchCorner = Instance.new("UICorner")
			switchCorner.CornerRadius = UDim.new(1, 0)
			switchCorner.Parent = switch
			
			local indicator = Instance.new("Frame")
			indicator.Name = "Indicator"
			indicator.Size = UDim2.new(0, 20, 0, 20)
			indicator.Position = UDim2.new(0, 3, 0.5, -10)
			indicator.BackgroundColor3 = getTheme().TextSecondary
			indicator.BorderSizePixel = 0
			indicator.AnchorPoint = Vector2.new(0, 0.5)
			
			local indicatorCorner = Instance.new("UICorner")
			indicatorCorner.CornerRadius = UDim.new(1, 0)
			indicatorCorner.Parent = indicator
			
			indicator.Parent = switch
			switch.Parent = toggle
			
			local interact = Instance.new("TextButton")
			interact.Name = "Interact"
			interact.Size = UDim2.new(1, 0, 1, 0)
			interact.BackgroundTransparency = 1
			interact.Text = ""
			interact.Parent = toggle
			
			toggle.Parent = tabPage
			
			local isToggled = toggleSettings.CurrentValue or false
			
			-- Update toggle state
			local function updateToggle()
				if isToggled then
					createTween(indicator, {
						Position = UDim2.new(1, -23, 0.5, -10),
						BackgroundColor3 = getTheme().Primary
					}):Play()
					createTween(switch, {
						BackgroundColor3 = Color3.fromRGB(
							math.floor(getTheme().Primary.R * 255 * 0.3),
							math.floor(getTheme().Primary.G * 255 * 0.3),
							math.floor(getTheme().Primary.B * 255 * 0.3)
						)
					}):Play()
				else
					createTween(indicator, {
						Position = UDim2.new(0, 3, 0.5, -10),
						BackgroundColor3 = getTheme().TextSecondary
					}):Play()
					createTween(switch, {
						BackgroundColor3 = getTheme().Medium
					}):Play()
				end
			end
			
			updateToggle()
			
			-- Click handler
			interact.MouseButton1Click:Connect(function()
				isToggled = not isToggled
				updateToggle()
				
				local success, err = pcall(function()
					toggleSettings.Callback(isToggled)
				end)
				
				if not success then
					warn("Toggle callback error:", err)
				end
			end)
			
			-- Hover effect
			applyHoverEffect(toggle, getTheme().Card, getTheme().CardHover)
			
			local toggleValue = {}
			function toggleValue:Set(value)
				isToggled = value
				updateToggle()
			end
			
			function toggleValue:Get()
				return isToggled
			end
			
			return toggleValue
		end
		
		-- Click handler for tab button
		interact.MouseButton1Click:Connect(function()
			-- Hide all tab pages
			for _, page in pairs(Elements:GetChildren()) do
				if page:IsA("ScrollingFrame") then
					page.Visible = false
				end
			end
			
			-- Show this tab page
			tabPage.Visible = true
			
			-- Update tab button appearance
			for _, btn in pairs(TabList:GetChildren()) do
				if btn:IsA("Frame") and btn.Name ~= "Template" then
					createTween(btn, {
						BackgroundColor3 = getTheme().Card
					}):Play()
					if btn:FindFirstChild("Title") then
						createTween(btn.Title, {
							TextColor3 = getTheme().TextSecondary
						}):Play()
					end
				end
			end
			
			createTween(tabButton, {
				BackgroundColor3 = getTheme().Primary
			}):Play()
			if tabButton:FindFirstChild("Title") then
				createTween(tabButton.Title, {
					TextColor3 = Color3.new(1, 1, 1)
				}):Play()
			end
		end)
		
		-- Show first tab by default
		if #TabList:GetChildren() == 1 then
			tabPage.Visible = true
			createTween(tabButton, {
				BackgroundColor3 = getTheme().Primary
			}):Play()
			if tabButton:FindFirstChild("Title") then
				tabButton.Title.TextColor3 = Color3.new(1, 1, 1)
			end
		end
		
		return Tab
	end
	
	-- Theme Changer
	function Window:ChangeTheme(themeName)
		local success = applyTheme(themeName)
		if success then
			RayfieldLibrary:Notify({
				Title = "Theme Changed",
				Content = string.format("Changed theme to %s", themeName),
				Duration = 3
			})
		end
		return success
	end
	
	-- Window Controls
	function Window:Minimize()
		createTween(Main, {
			Size = UDim2.new(0, 500, 0, 45)
		}):Play()
	end
	
	function Window:Maximize()
		createTween(Main, {
			Size = UDim2.new(0, 500, 0, 400)
		}):Play()
	end
	
	function Window:Hide()
		createTween(Main, {
			Position = UDim2.new(0.5, 0, 1.5, 0)
		}):Play()
		RayfieldLibrary:Notify({
			Title = "Interface Hidden",
			Content = "Press " .. (settings.ToggleKey or "RightShift") .. " to show",
			Duration = 5
		})
	end
	
	function Window:Show()
		createTween(Main, {
			Position = UDim2.new(0.5, 0, 0.5, 0)
		}):Play()
	end
	
	-- Setup window controls
	if Topbar:FindFirstChild("Hide") then
		Topbar.Hide.MouseButton1Click:Connect(function()
			Window:Hide()
		end)
	end
	
	if Topbar:FindFirstChild("ChangeSize") then
		Topbar.ChangeSize.MouseButton1Click:Connect(function()
			if Main.Size.Y.Offset > 100 then
				Window:Minimize()
			else
				Window:Maximize()
			end
		end)
	end
	
	-- Keybind to show/hide
	if settings.ToggleKey then
		UserInputService.InputBegan:Connect(function(input, processed)
			if not processed and input.KeyCode == Enum.KeyCode[settings.ToggleKey] then
				if Main.Position.Y.Offset > 1 then
					Window:Show()
				else
					Window:Hide()
				end
			end
		end)
	end
	
	-- Make draggable
	local dragging = false
	local dragStart, startPos
	
	Topbar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = Main.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			Main.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)
	
	-- Send welcome notification
	task.wait(1)
	RayfieldLibrary:Notify({
		Title = "Welcome",
		Content = string.format("%s loaded successfully!", settings.Name or "Rayfield Pink"),
		Duration = 5
	})
	
	return Window
end

-- Initialize library functions
function RayfieldLibrary:LoadConfiguration()
	RayfieldLibrary:Notify({
		Title = "Configuration",
		Content = "Configuration system loaded",
		Duration = 3
	})
end

function RayfieldLibrary:SetVisibility(visible)
	if visible then
		Rayfield.Enabled = true
		createTween(Main, {BackgroundTransparency = 0}):Play()
	else
		createTween(Main, {BackgroundTransparency = 1}):Play()
		task.wait(0.3)
		Rayfield.Enabled = false
	end
end

function RayfieldLibrary:Destroy()
	createTween(Main, {
		Size = UDim2.new(0, 0, 0, 0),
		BackgroundTransparency = 1
	}):Play()
	
	task.wait(0.5)
	Rayfield:Destroy()
end

-- Return the library
return RayfieldLibrary
