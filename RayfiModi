--[[
    Rayfield Pink Mod - Premium Edition
    ðŸŽ€ Professionelles Pink/Schwarz Interface
    ðŸ”¥ Alle Bugs gefixt & optimiert
    âœ¨ Ultra-smooth Animationen
]]

-- Services
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Rayfield Library
local Rayfield = {}

-- Premium Theme System
Rayfield.Themes = {
    PinkGlamour = {
        -- Backgrounds
        Background = Color3.fromRGB(10, 10, 12),
        Topbar = Color3.fromRGB(15, 15, 18),
        Card = Color3.fromRGB(20, 20, 24),
        CardHover = Color3.fromRGB(28, 28, 32),
        
        -- Pink Accents
        Primary = Color3.fromRGB(255, 105, 180),     -- Hot Pink
        Secondary = Color3.fromRGB(255, 20, 147),    -- Deep Pink
        Accent = Color3.fromRGB(255, 182, 193),      -- Light Pink
        Glow = Color3.fromRGB(255, 105, 180),        -- Glow Effect
        
        -- Text
        Text = Color3.fromRGB(245, 245, 245),
        TextSecondary = Color3.fromRGB(200, 200, 200),
        TextMuted = Color3.fromRGB(150, 150, 150),
        
        -- Special
        Success = Color3.fromRGB(46, 204, 113),
        Warning = Color3.fromRGB(241, 196, 15),
        Error = Color3.fromRGB(231, 76, 60),
        Info = Color3.fromRGB(52, 152, 219),
        
        -- Borders
        Border = Color3.fromRGB(40, 40, 45),
        BorderLight = Color3.fromRGB(60, 60, 65),
        
        -- Transparencies
        ShadowOpacity = 0.3,
        HoverOpacity = 0.1,
        ActiveOpacity = 0.2
    },
    
    PinkCyber = {
        Background = Color3.fromRGB(5, 5, 8),
        Topbar = Color3.fromRGB(10, 5, 15),
        Card = Color3.fromRGB(15, 10, 20),
        CardHover = Color3.fromRGB(25, 15, 30),
        Primary = Color3.fromRGB(255, 0, 128),
        Secondary = Color3.fromRGB(180, 0, 90),
        Accent = Color3.fromRGB(128, 0, 64),
        Text = Color3.fromRGB(240, 240, 255),
        TextSecondary = Color3.fromRGB(180, 180, 200),
        Border = Color3.fromRGB(50, 30, 70),
        Glow = Color3.fromRGB(255, 0, 128)
    },
    
    PinkRoyal = {
        Background = Color3.fromRGB(15, 12, 18),
        Topbar = Color3.fromRGB(20, 15, 25),
        Card = Color3.fromRGB(25, 20, 30),
        CardHover = Color3.fromRGB(35, 25, 40),
        Primary = Color3.fromRGB(219, 112, 147),
        Secondary = Color3.fromRGB(199, 21, 133),
        Accent = Color3.fromRGB(255, 182, 193),
        Text = Color3.fromRGB(230, 220, 240),
        TextSecondary = Color3.fromRGB(180, 170, 190),
        Border = Color3.fromRGB(50, 40, 60),
        Glow = Color3.fromRGB(219, 112, 147)
    }
}

Rayfield.CurrentTheme = "PinkGlamour"
Rayfield.Flags = {}
Rayfield.Windows = {}

-- Helper Functions
local function GetTheme()
    return Rayfield.Themes[Rayfield.CurrentTheme]
end

local function CreateTween(object, properties, duration)
    duration = duration or 0.25
    return TweenService:Create(
        object,
        TweenInfo.new(duration, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
        properties
    )
end

local function CreateRoundedFrame(parent, size, position, color, cornerRadius)
    local frame = Instance.new("Frame")
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = color
    frame.BackgroundTransparency = 0
    frame.BorderSizePixel = 0
    frame.ClipsDescendants = true
    frame.ZIndex = 1
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, cornerRadius or 10)
    corner.Parent = frame
    
    if parent then
        frame.Parent = parent
    end
    
    return frame
end

local function CreateTextLabel(parent, text, size, position, textSize, bold, color, alignment)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Size = size
    label.Position = position
    label.BackgroundTransparency = 1
    label.TextColor3 = color or GetTheme().Text
    label.TextSize = textSize or 14
    label.Font = bold and Enum.Font.GothamSemibold or Enum.Font.Gotham
    label.TextXAlignment = alignment or Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.TextWrapped = false
    label.ZIndex = 2
    
    if parent then
        label.Parent = parent
    end
    
    return label
end

local function CreateStroke(object, color, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or GetTheme().Border
    stroke.Thickness = thickness or 1
    stroke.Transparency = 0
    stroke.Parent = object
    return stroke
end

local function CreateShadow(object)
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "Shadow"
    shadow.Size = UDim2.new(1, 14, 1, 14)
    shadow.Position = UDim2.new(0, -7, 0, -7)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://5554236805"
    shadow.ImageColor3 = Color3.new(0, 0, 0)
    shadow.ImageTransparency = GetTheme().ShadowOpacity or 0.5
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(23, 23, 277, 277)
    shadow.ZIndex = 0
    shadow.Parent = object
    return shadow
end

local function CreateIconButton(parent, icon, size, position, color)
    local button = Instance.new("TextButton")
    button.Size = size
    button.Position = position
    button.BackgroundColor3 = color or GetTheme().Card
    button.Text = icon
    button.TextColor3 = Color3.new(1, 1, 1)
    button.TextSize = 18
    button.Font = Enum.Font.GothamBold
    button.BorderSizePixel = 0
    button.ZIndex = 3
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    -- Hover effect
    button.MouseEnter:Connect(function()
        CreateTween(button, {BackgroundTransparency = 0.2}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        CreateTween(button, {BackgroundTransparency = 0}):Play()
    end)
    
    if parent then
        button.Parent = parent
    end
    
    return button
end

-- Main Window Creation
function Rayfield.CreateWindow(settings)
    settings = settings or {}
    
    -- Clean old windows
    for _, gui in pairs(game.CoreGui:GetChildren()) do
        if gui.Name == "RayfieldPremium" then
            gui:Destroy()
        end
    end
    
    -- Create ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "RayfieldPremium"
    ScreenGui.DisplayOrder = 999
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- GUI Protection
    if syn and syn.protect_gui then
        syn.protect_gui(ScreenGui)
        ScreenGui.Parent = game.CoreGui
    elseif gethui then
        ScreenGui.Parent = gethui()
    else
        ScreenGui.Parent = game.CoreGui
    end
    
    -- Main Container with Shadow
    local Main = CreateRoundedFrame(ScreenGui,
        UDim2.new(0, 520, 0, 420),
        UDim2.new(0.5, -260, 0.5, -210),
        GetTheme().Background,
        14
    )
    Main.Name = "Main"
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    
    -- Add shadow
    CreateShadow(Main)
    
    -- Topbar with Gradient
    local Topbar = CreateRoundedFrame(Main,
        UDim2.new(1, 0, 0, 48),
        UDim2.new(0, 0, 0, 0),
        GetTheme().Topbar,
        14
    )
    Topbar.Name = "Topbar"
    Topbar.ZIndex = 3
    
    local TopbarCorner = Instance.new("UICorner")
    TopbarCorner.CornerRadius = UDim.new(0, 14, 0, 0)
    TopbarCorner.Parent = Topbar
    
    -- Topbar Divider
    local TopbarDivider = Instance.new("Frame")
    TopbarDivider.Size = UDim2.new(1, 0, 0, 1)
    TopbarDivider.Position = UDim2.new(0, 0, 1, -1)
    TopbarDivider.BackgroundColor3 = GetTheme().Border
    TopbarDivider.BorderSizePixel = 0
    TopbarDivider.ZIndex = 4
    TopbarDivider.Parent = Topbar
    
    -- Window Title
    local Title = CreateTextLabel(Topbar, settings.Name or "ðŸŽ€ Rayfield Premium",
        UDim2.new(1, -120, 1, 0),
        UDim2.new(0, 20, 0, 0),
        18, true,
        GetTheme().Text,
        Enum.TextXAlignment.Left
    )
    
    -- Window Controls Container (FIXED POSITION)
    local ControlsContainer = CreateRoundedFrame(Topbar,
        UDim2.new(0, 80, 0, 32),
        UDim2.new(1, -90, 0.5, -16),
        Color3.fromRGB(30, 30, 35),
        8
    )
    ControlsContainer.AnchorPoint = Vector2.new(0, 0.5)
    ControlsContainer.ZIndex = 5
    
    -- Minimize Button (FIXED)
    local MinimizeButton = CreateIconButton(ControlsContainer, "â”€",
        UDim2.new(0, 30, 0, 30),
        UDim2.new(0, 5, 0.5, -15),
        GetTheme().Secondary
    )
    MinimizeButton.Name = "Minimize"
    MinimizeButton.AnchorPoint = Vector2.new(0, 0.5)
    
    -- Close Button (FIXED - richtige Position)
    local CloseButton = CreateIconButton(ControlsContainer, "Ã—",
        UDim2.new(0, 30, 0, 30),
        UDim2.new(1, -35, 0.5, -15),
        GetTheme().Error
    )
    CloseButton.Name = "Close"
    CloseButton.AnchorPoint = Vector2.new(0, 0.5)
    
    -- Sidebar Container
    local Sidebar = CreateRoundedFrame(Main,
        UDim2.new(0, 170, 1, -58),
        UDim2.new(0, 10, 0, 58),
        GetTheme().Card,
        10
    )
    Sidebar.Name = "Sidebar"
    Sidebar.ZIndex = 2
    
    -- Sidebar Tabs List
    local TabList = Instance.new("ScrollingFrame")
    TabList.Name = "TabList"
    TabList.Size = UDim2.new(1, -10, 1, -10)
    TabList.Position = UDim2.new(0, 5, 0, 5)
    TabList.BackgroundTransparency = 1
    TabList.ScrollBarThickness = 4
    TabList.ScrollBarImageColor3 = GetTheme().Primary
    TabList.CanvasSize = UDim2.new(0, 0, 0, 0)
    TabList.AutomaticCanvasSize = Enum.AutomaticSize.Y
    TabList.ZIndex = 3
    
    local TabListLayout = Instance.new("UIListLayout")
    TabListLayout.Padding = UDim.new(0, 10)
    TabListLayout.Parent = TabList
    
    TabList.Parent = Sidebar
    
    -- Content Area
    local ContentArea = CreateRoundedFrame(Main,
        UDim2.new(1, -190, 1, -58),
        UDim2.new(0, 180, 0, 58),
        GetTheme().Card,
        10
    )
    ContentArea.Name = "ContentArea"
    ContentArea.ZIndex = 2
    
    -- Content Scroller
    local ContentScroller = Instance.new("ScrollingFrame")
    ContentScroller.Name = "ContentScroller"
    ContentScroller.Size = UDim2.new(1, -10, 1, -10)
    ContentScroller.Position = UDim2.new(0, 5, 0, 5)
    ContentScroller.BackgroundTransparency = 1
    ContentScroller.ScrollBarThickness = 4
    ContentScroller.ScrollBarImageColor3 = GetTheme().Primary
    ContentScroller.CanvasSize = UDim2.new(0, 0, 0, 0)
    ContentScroller.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ContentScroller.ZIndex = 3
    
    local ContentLayout = Instance.new("UIListLayout")
    ContentLayout.Padding = UDim.new(0, 14)
    ContentLayout.Parent = ContentScroller
    
    ContentScroller.Parent = ContentArea
    
    -- State Variables
    local Tabs = {}
    local CurrentTab = nil
    local IsDragging = false
    local DragStart, StartPosition
    local IsMinimized = false
    
    -- Window Dragging
    Topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            IsDragging = true
            DragStart = input.Position
            StartPosition = Main.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    IsDragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if IsDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local Delta = input.Position - DragStart
            Main.Position = UDim2.new(
                StartPosition.X.Scale,
                StartPosition.X.Offset + Delta.X,
                StartPosition.Y.Scale,
                StartPosition.Y.Offset + Delta.Y
            )
        end
    end)
    
    -- Close Button Function
    CloseButton.MouseButton1Click:Connect(function()
        CreateTween(Main, {
            Size = UDim2.new(0, 0, 0, 0),
            BackgroundTransparency = 1
        }, 0.3):Play()
        
        CreateTween(Topbar, {
            BackgroundTransparency = 1
        }, 0.3):Play()
        
        task.wait(0.3)
        ScreenGui:Destroy()
    end)
    
    -- Minimize Button Function
    MinimizeButton.MouseButton1Click:Connect(function()
        IsMinimized = not IsMinimized
        
        if IsMinimized then
            -- Minimize
            CreateTween(Main, {
                Size = UDim2.new(0, 520, 0, 50)
            }, 0.3):Play()
            
            CreateTween(Sidebar, {
                BackgroundTransparency = 1
            }, 0.2):Play()
            
            CreateTween(ContentArea, {
                BackgroundTransparency = 1
            }, 0.2):Play()
            
            task.wait(0.2)
            Sidebar.Visible = false
            ContentArea.Visible = false
        else
            -- Restore
            Sidebar.Visible = true
            ContentArea.Visible = true
            
            CreateTween(Sidebar, {
                BackgroundTransparency = 0
            }, 0.2):Play()
            
            CreateTween(ContentArea, {
                BackgroundTransparency = 0
            }, 0.2):Play()
            
            CreateTween(Main, {
                Size = UDim2.new(0, 520, 0, 420)
            }, 0.3):Play()
        end
    end)
    
    -- Window Object
    local Window = {}
    
    -- Create Tab Function
    function Window:CreateTab(name, icon)
        local Tab = {}
        
        -- Tab Button
        local TabButton = CreateRoundedFrame(nil,
            UDim2.new(1, 0, 0, 48),
            UDim2.new(0, 0, 0, 0),
            GetTheme().Card,
            8
        )
        TabButton.Name = name
        CreateStroke(TabButton, 1, GetTheme().BorderLight)
        TabButton.ZIndex = 4
        
        -- Tab Icon (optional)
        if icon then
            local IconLabel = CreateTextLabel(TabButton, icon,
                UDim2.new(0, 24, 0, 24),
                UDim2.new(0, 12, 0.5, -12),
                16, false,
                GetTheme().TextSecondary,
                Enum.TextXAlignment.Center
            )
            IconLabel.TextYAlignment = Enum.TextYAlignment.Center
        end
        
        -- Tab Title
        local textOffset = icon and 40 or 15
        local TabTitle = CreateTextLabel(TabButton, name,
            UDim2.new(1, -textOffset, 1, 0),
            UDim2.new(0, textOffset, 0, 0),
            14, true,
            GetTheme().TextSecondary
        )
        
        -- Tab Interaction
        local TabInteract = Instance.new("TextButton")
        TabInteract.Name = "Interact"
        TabInteract.Size = UDim2.new(1, 0, 1, 0)
        TabInteract.BackgroundTransparency = 1
        TabInteract.Text = ""
        TabInteract.ZIndex = 5
        TabInteract.Parent = TabButton
        
        TabButton.Parent = TabList
        
        -- Tab Content
        local TabContent = Instance.new("Frame")
        TabContent.Name = name
        TabContent.Size = UDim2.new(1, 0, 0, 0)
        TabContent.BackgroundTransparency = 1
        TabContent.Visible = false
        TabContent.ZIndex = 3
        
        local TabContentLayout = Instance.new("UIListLayout")
        TabContentLayout.Padding = UDim.new(0, 14)
        TabContentLayout.Parent = TabContent
        
        TabContent.Parent = ContentScroller
        
        -- Tab Selection
        TabInteract.MouseButton1Click:Connect(function()
            if CurrentTab then
                CurrentTab.Visible = false
            end
            
            -- Reset all tab buttons
            for _, btn in pairs(TabList:GetChildren()) do
                if btn:IsA("Frame") then
                    CreateTween(btn, {
                        BackgroundColor3 = GetTheme().Card,
                        BackgroundTransparency = 0
                    }):Play()
                    
                    if btn:FindFirstChildWhichIsA("TextLabel") then
                        CreateTween(btn:FindFirstChildWhichIsA("TextLabel"), {
                            TextColor3 = GetTheme().TextSecondary
                        }):Play()
                    end
                end
            end
            
            -- Highlight active tab
            CreateTween(TabButton, {
                BackgroundColor3 = GetTheme().Primary,
                BackgroundTransparency = 0.1
            }):Play()
            
            CreateTween(TabTitle, {
                TextColor3 = Color3.new(1, 1, 1)
            }):Play()
            
            -- Show content
            TabContent.Visible = true
            CurrentTab = TabContent
        end)
        
        -- Activate first tab
        if #TabList:GetChildren() == 1 then
            task.wait(0.1)
            TabInteract:Fire()
        end
        
        -- UI Elements
        
        -- Section
        function Tab:CreateSection(title)
            local Section = Instance.new("Frame")
            Section.Size = UDim2.new(1, 0, 0, 30)
            Section.BackgroundTransparency = 1
            
            local SectionTitle = CreateTextLabel(Section, string.upper(title),
                UDim2.new(1, -20, 1, 0),
                UDim2.new(0, 10, 0, 0),
                12, true,
                GetTheme().TextMuted
            )
            
            Section.Parent = TabContent
            
            local SectionObj = {}
            function SectionObj:Set(newTitle)
                SectionTitle.Text = string.upper(newTitle)
            end
            
            return SectionObj
        end
        
        -- Button
        function Tab:CreateButton(settings)
            local Button = CreateRoundedFrame(TabContent,
                UDim2.new(1, 0, 0, 42),
                UDim2.new(0, 0, 0, 0),
                GetTheme().Card,
                8
            )
            Button.Name = settings.Name
            CreateStroke(Button, 1, GetTheme().Border)
            
            local ButtonTitle = CreateTextLabel(Button, settings.Name,
                UDim2.new(1, -20, 1, 0),
                UDim2.new(0, 15, 0, 0),
                14, true
            )
            
            local ButtonInteract = Instance.new("TextButton")
            ButtonInteract.Size = UDim2.new(1, 0, 1, 0)
            ButtonInteract.BackgroundTransparency = 1
            ButtonInteract.Text = ""
            ButtonInteract.Parent = Button
            
            -- Hover effect
            ButtonInteract.MouseEnter:Connect(function()
                CreateTween(Button, {
                    BackgroundColor3 = GetTheme().CardHover
                }):Play()
                CreateTween(Button.UIStroke, {
                    Color = GetTheme().Primary
                }):Play()
            end)
            
            ButtonInteract.MouseLeave:Connect(function()
                CreateTween(Button, {
                    BackgroundColor3 = GetTheme().Card
                }):Play()
                CreateTween(Button.UIStroke, {
                    Color = GetTheme().Border
                }):Play()
            end)
            
            -- Click effect
            ButtonInteract.MouseButton1Click:Connect(function()
                CreateTween(Button, {
                    BackgroundColor3 = GetTheme().Primary,
                    BackgroundTransparency = 0.2
                }):Play()
                
                task.wait(0.1)
                
                CreateTween(Button, {
                    BackgroundColor3 = GetTheme().Card,
                    BackgroundTransparency = 0
                }):Play()
                
                if settings.Callback then
                    pcall(settings.Callback)
                end
            end)
            
            local ButtonObj = {}
            function ButtonObj:Set(newName)
                Button.Name = newName
                ButtonTitle.Text = newName
            end
            
            return ButtonObj
        end
        
        -- Toggle
        function Tab:CreateToggle(settings)
            local Toggle = CreateRoundedFrame(TabContent,
                UDim2.new(1, 0, 0, 42),
                UDim2.new(0, 0, 0, 0),
                GetTheme().Card,
                8
            )
            Toggle.Name = settings.Name
            CreateStroke(Toggle, 1, GetTheme().Border)
            
            local ToggleTitle = CreateTextLabel(Toggle, settings.Name,
                UDim2.new(1, -80, 1, 0),
                UDim2.new(0, 15, 0, 0),
                14, true
            )
            
            -- Toggle Switch
            local Switch = CreateRoundedFrame(Toggle,
                UDim2.new(0, 52, 0, 26),
                UDim2.new(1, -62, 0.5, -13),
                GetTheme().CardHover,
                13
            )
            Switch.AnchorPoint = Vector2.new(0, 0.5)
            
            local Knob = CreateRoundedFrame(Switch,
                UDim2.new(0, 22, 0, 22),
                UDim2.new(0, 2, 0.5, -11),
                GetTheme().Text,
                11
            )
            Knob.AnchorPoint = Vector2.new(0, 0.5)
            
            local ToggleInteract = Instance.new("TextButton")
            ToggleInteract.Size = UDim2.new(1, 0, 1, 0)
            ToggleInteract.BackgroundTransparency = 1
            ToggleInteract.Text = ""
            ToggleInteract.Parent = Toggle
            
            local State = settings.CurrentValue or false
            
            local function UpdateToggle()
                if State then
                    CreateTween(Knob, {
                        Position = UDim2.new(1, -24, 0.5, -11),
                        BackgroundColor3 = GetTheme().Primary
                    }):Play()
                    CreateTween(Switch, {
                        BackgroundColor3 = Color3.fromRGB(
                            math.floor(GetTheme().Primary.R * 255 * 0.15),
                            math.floor(GetTheme().Primary.G * 255 * 0.15),
                            math.floor(GetTheme().Primary.B * 255 * 0.15)
                        )
                    }):Play()
                else
                    CreateTween(Knob, {
                        Position = UDim2.new(0, 2, 0.5, -11),
                        BackgroundColor3 = GetTheme().TextSecondary
                    }):Play()
                    CreateTween(Switch, {
                        BackgroundColor3 = GetTheme().CardHover
                    }):Play()
                end
            end
            
            UpdateToggle()
            
            -- Click handler
            ToggleInteract.MouseButton1Click:Connect(function()
                State = not State
                UpdateToggle()
                
                if settings.Callback then
                    pcall(settings.Callback, State)
                end
            end)
            
            local ToggleObj = {}
            function ToggleObj:Set(value)
                State = value
                UpdateToggle()
            end
            
            function ToggleObj:Get()
                return State
            end
            
            return ToggleObj
        end
        
        -- Slider
        function Tab:CreateSlider(settings)
            local Slider = CreateRoundedFrame(TabContent,
                UDim2.new(1, 0, 0, 68),
                UDim2.new(0, 0, 0, 0),
                GetTheme().Card,
                8
            )
            Slider.Name = settings.Name
            CreateStroke(Slider, 1, GetTheme().Border)
            
            local SliderTitle = CreateTextLabel(Slider, settings.Name,
                UDim2.new(1, -20, 0, 22),
                UDim2.new(0, 15, 0, 10),
                14, true
            )
            
            local SliderValue = CreateTextLabel(Slider,
                tostring(settings.CurrentValue or settings.Range[1]) .. (settings.Suffix or ""),
                UDim2.new(0, 80, 0, 22),
                UDim2.new(1, -95, 0, 10),
                14, false,
                GetTheme().Primary,
                Enum.TextXAlignment.Right
            )
            
            -- Slider Track
            local Track = CreateRoundedFrame(Slider,
                UDim2.new(1, -30, 0, 10),
                UDim2.new(0, 15, 0, 45),
                GetTheme().CardHover,
                5
            )
            
            local Fill = CreateRoundedFrame(Track,
                UDim2.new(0.5, 0, 1, 0),
                UDim2.new(0, 0, 0, 0),
                GetTheme().Primary,
                5
            )
            
            local SliderInteract = Instance.new("TextButton")
            SliderInteract.Size = UDim2.new(1, -30, 0, 25)
            SliderInteract.Position = UDim2.new(0, 15, 0, 40)
            SliderInteract.BackgroundTransparency = 1
            SliderInteract.Text = ""
            SliderInteract.Parent = Slider
            
            local CurrentValue = settings.CurrentValue or settings.Range[1]
            local Range = settings.Range or {0, 100}
            local IsDragging = false
            
            local function UpdateSlider(value)
                value = math.clamp(value, Range[1], Range[2])
                CurrentValue = value
                
                local percentage = (value - Range[1]) / (Range[2] - Range[1])
                Fill.Size = UDim2.new(percentage, 0, 1, 0)
                SliderValue.Text = string.format("%.1f", value) .. (settings.Suffix or "")
            end
            
            UpdateSlider(CurrentValue)
            
            -- Drag handling
            SliderInteract.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = true
                end
            end)
            
            SliderInteract.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsDragging = false
                end
            end)
            
            UserInputService.InputChanged:Connect(function(input)
                if IsDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local mousePos = UserInputService:GetMouseLocation()
                    local trackPos = Track.AbsolutePosition
                    local trackSize = Track.AbsoluteSize
                    
                    local relativeX = math.clamp(
                        (mousePos.X - trackPos.X) / trackSize.X,
                        0, 1
                    )
                    
                    local newValue = Range[1] + relativeX * (Range[2] - Range[1])
                    
                    if settings.Increment then
                        newValue = math.floor(newValue / settings.Increment + 0.5) * settings.Increment
                    end
                    
                    UpdateSlider(newValue)
                    
                    if settings.Callback then
                        pcall(settings.Callback, newValue)
                    end
                end
            end)
            
            local SliderObj = {}
            function SliderObj:Set(value)
                UpdateSlider(value)
                if settings.Callback then
                    pcall(settings.Callback, value)
                end
            end
            
            function SliderObj:Get()
                return CurrentValue
            end
            
            return SliderObj
        end
        
        -- Label
        function Tab:CreateLabel(text)
            local Label = CreateRoundedFrame(TabContent,
                UDim2.new(1, 0, 0, 38),
                UDim2.new(0, 0, 0, 0),
                Color3.fromRGB(30, 30, 35),
                8
            )
            
            CreateTextLabel(Label, text,
                UDim2.new(1, -20, 1, 0),
                UDim2.new(0, 15, 0, 0),
                14, false,
                GetTheme().TextSecondary
            )
            
            local LabelObj = {}
            function LabelObj:Set(newText)
                if Label:FindFirstChildWhichIsA("TextLabel") then
                    Label:FindFirstChildWhichIsA("TextLabel").Text = newText
                end
            end
            
            return LabelObj
        end
        
        table.insert(Tabs, Tab)
        return Tab
    end
    
    -- Window Controls
    
    function Window:Hide()
        CreateTween(Main, {
            Position = UDim2.new(0.5, 0, 1.5, 0),
            BackgroundTransparency = 0.5
        }):Play()
    end
    
    function Window:Show()
        CreateTween(Main, {
            Position = UDim2.new(0.5, 0, 0.5, 0),
            BackgroundTransparency = 0
        }):Play()
    end
    
    function Window:ChangeTheme(themeName)
        if Rayfield.Themes[themeName] then
            Rayfield.CurrentTheme = themeName
            
            -- Update all colors
            Main.BackgroundColor3 = GetTheme().Background
            Topbar.BackgroundColor3 = GetTheme().Topbar
            Sidebar.BackgroundColor3 = GetTheme().Card
            ContentArea.BackgroundColor3 = GetTheme().Card
            ControlsContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
            
            -- Update text
            Title.TextColor3 = GetTheme().Text
            
            return true
        end
        return false
    end
    
    -- Notification System
    function Window:Notify(settings)
        local theme = GetTheme()
        
        local Notification = CreateRoundedFrame(ScreenGui,
            UDim2.new(0, 340, 0, 90),
            UDim2.new(1, 10, 0, 10),
            theme.Card,
            12
        )
        Notification.ZIndex = 1000
        CreateStroke(Notification, 2, theme.Primary)
        CreateShadow(Notification)
        
        -- Title
        CreateTextLabel(Notification, settings.Title or "Notification",
            UDim2.new(1, -20, 0, 32),
            UDim2.new(0, 15, 0, 10),
            16, true,
            theme.Text
        )
        
        -- Content
        CreateTextLabel(Notification, settings.Content or "",
            UDim2.new(1, -20, 1, -42),
            UDim2.new(0, 15, 0, 42),
            14, false,
            theme.TextSecondary
        )
        
        -- Animation
        CreateTween(Notification, {
            Position = UDim2.new(1, -350, 0, 10)
        }):Play()
        
        -- Auto remove
        task.wait(settings.Duration or 4)
        
        CreateTween(Notification, {
            Position = UDim2.new(1, 10, 0, 10),
            BackgroundTransparency = 1
        }):Play()
        
        task.wait(0.3)
        Notification:Destroy()
    end
    
    -- Keybind Support
    if settings.ToggleKey then
        UserInputService.InputBegan:Connect(function(input, processed)
            if not processed and input.KeyCode == Enum.KeyCode[settings.ToggleKey] then
                if Main.Position.Y.Offset > 1 then
                    Window:Show()
                else
                    Window:Hide()
                end
            end
        end)
    end
    
    -- Welcome Notification
    task.wait(0.5)
    Window:Notify({
        Title = "ðŸŽ€ Rayfield Premium",
        Content = "Premium Interface geladen!",
        Duration = 3
    })
    
    table.insert(Rayfield.Windows, Window)
    return Window
end

-- Library Functions
function Rayfield:Notify(settings)
    if #Rayfield.Windows > 0 then
        Rayfield.Windows[1]:Notify(settings)
    else
        warn("Rayfield: " .. (settings.Title or "Notification") .. " - " .. (settings.Content or ""))
    end
end

return Rayfield
